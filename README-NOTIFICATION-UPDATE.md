# echo アプリ 通知機能アップデート

## 通知センター機能拡張

通知センター機能に以下の拡張機能を実装しました：

1. **プッシュ通知機能の実装**
2. **メール通知のバックエンド連携**
3. **通知分析ダッシュボードの開発**
4. **ユーザー別通知設定の保存機能**

## 依存関係のインストール

このアップデートでは、グラフ描画用に `recharts` ライブラリが必要です。以下のコマンドでインストールしてください：

```bash
npm install recharts @types/recharts
```

または

```bash
yarn add recharts @types/recharts
```

## エラーの修正

エラーログに表示されていた問題は以下のように修正しました：

1. Rechartsライブラリの依存関係エラー - 上記のインストールコマンドで解決
2. TypeScriptの型定義エラー - 型定義の修正と明示的な型宣言を追加

## 変更点の概要

### 1. プッシュ通知機能

- `pushNotificationService.ts` - FCM/APNs連携のためのサービス
- `service-worker.js` - バックグラウンド通知処理とユーザーインタラクション対応
- プッシュ通知許可リクエストUIの追加

### 2. メール通知のバックエンド連携

- `emailNotificationService.ts` - メールテンプレート管理と配信機能
- 通知設定との連携によるカテゴリごとのメール配信制御

### 3. 通知分析ダッシュボード

- `NotificationAnalyticsDashboard` - 管理者向け通知データ分析ダッシュボード
- 通知メトリクス、トレンド、タイプ別分析、デバイス統計の可視化
- 日付範囲選択機能

### 4. ユーザー別通知設定

- `NotificationSettings` コンポーネントの拡張
- ユーザー設定の永続化と複数デバイス間での同期対応
- 管理者向けダッシュボードへのリンク追加

## 使用方法

### 管理者用通知分析ダッシュボードへのアクセス

管理者アカウント（userId === 'admin'）でログインした場合、通知設定ページから分析ダッシュボードへアクセスできます。

### プッシュ通知の有効化

1. 通知設定ページからプッシュ通知を有効にする
2. ブラウザの通知許可を承認する
3. デバイス登録が自動的に行われる

## 注意事項

- recharts ライブラリのインストールが必須です
- サービスワーカーが正しく登録されるためにHTTPSでの実行が推奨されます

## 今後の拡張予定

- 通知分析のユーザーセグメント分析
- メールテンプレートのカスタマイザ
- プッシュ通知のリッチコンテンツ対応
- A/Bテストフレームワークの統合
